
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Escrevendo sua primeira aplicação Django, parte 4 &mdash; Django v1.3.1 documentation</title>
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.3.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Django v1.3.1 documentation" href="../index.html" />
    <link rel="up" title="Primeiros passos" href="index.html" />
    <link rel="next" title="What to read next" href="whatsnext.html" />
    <link rel="prev" title="Escrevendo sua primeira aplicação Django, parte 3" href="tutorial03.html" />
 
<script type="text/javascript" src="../templatebuiltins.js"></script>
<script type="text/javascript">
(function($) {
    if (!django_template_builtins) {
       // templatebuiltins.js missing, do nothing.
       return;
    }
    $(document).ready(function() {
        // Hyperlink Django template tags and filters
        var base = "../ref/templates/builtins.html";
        if (base == "#") {
            // Special case for builtins.html itself
            base = "";
        }
        // Tags are keywords, class '.k'
        $("div.highlight\\-html\\+django span.k").each(function(i, elem) {
             var tagname = $(elem).text();
             if ($.inArray(tagname, django_template_builtins.ttags) != -1) {
                 var fragment = tagname.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + tagname + "</a>");
             }
        });
        // Filters are functions, class '.nf'
        $("div.highlight\\-html\\+django span.nf").each(function(i, elem) {
             var filtername = $(elem).text();
             if ($.inArray(filtername, django_template_builtins.tfilters) != -1) {
                 var fragment = filtername.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + filtername + "</a>");
             }
        });
    });
})(jQuery);
</script>

  </head>
  <body>

    <div class="document">
  <div id="custom-doc" class="yui-t6">
    <div id="hd">
      <h1><a href="../index.html">Django v1.3.1 documentation</a></h1>
      <div id="global-nav">
        <a title="Home page" href="../index.html">Home</a>  |
        <a title="Tabela de conteúdos" href="../contents.html">Tabela de conteúdos</a>  |
        <a title="Índice Global" href="../genindex.html">Índice</a>  |
        <a title="Busca" href="../py-modindex.html">Módulos</a>
      </div>
      <div class="nav">
    &laquo; <a href="tutorial03.html" title="Escrevendo sua primeira aplicação Django, parte 3">previous</a> 
     |
    <a href="index.html" title="Primeiros passos" accesskey="U">up</a>
   |
    <a href="whatsnext.html" title="What to read next">next</a> &raquo;</div>
    </div>
    
    <div id="bd">
      <div id="yui-main">
        <div class="yui-b">
          <div class="yui-g" id="intro-tutorial04">
            
  <div class="section" id="s-escrevendo-sua-primeira-aplicacao-django-parte-4">
<span id="s-intro-tutorial04"></span><span id="escrevendo-sua-primeira-aplicacao-django-parte-4"></span><span id="intro-tutorial04"></span><h1>Escrevendo sua primeira aplicação Django, parte 4<a class="headerlink" href="#escrevendo-sua-primeira-aplicacao-django-parte-4" title="Permalink to this headline">¶</a></h1>
<p>Este tutorial inicia-se onde o <a class="reference internal" href="tutorial03.html#intro-tutorial03"><em>Tutorial 3</em></a> terminou.
Estamos continuando a aplicação web de enquete e concentraremos em uma forma
simples de processamento de formulário e a redução de nosso código.</p>
<div class="section" id="s-escreva-um-simples-formulario">
<span id="escreva-um-simples-formulario"></span><h2>Escreva um simples formulário<a class="headerlink" href="#escreva-um-simples-formulario" title="Permalink to this headline">¶</a></h2>
<p>Vamos atualizar nosso template de detalhamento da enquete (&#8220;polls/detail.html&#8221;)
do último tutorial, para que ele contenha um elemento HTML <tt class="docutils literal"><span class="pre">&lt;form&gt;</span></tt>:</p>
<div class="highlight-html+django"><div class="highlight"><pre><span class="nt">&lt;h1&gt;</span><span class="cp">{{</span> <span class="nv">poll.question</span> <span class="cp">}}</span><span class="nt">&lt;/h1&gt;</span>

<span class="cp">{%</span> <span class="k">if</span> <span class="nv">error_message</span> <span class="cp">%}</span><span class="nt">&lt;p&gt;&lt;strong&gt;</span><span class="cp">{{</span> <span class="nv">error_message</span> <span class="cp">}}</span><span class="nt">&lt;/strong&gt;&lt;/p&gt;</span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>

<span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">&quot;/polls/</span><span class="cp">{{</span> <span class="nv">poll.id</span> <span class="cp">}}</span><span class="s">/vote/&quot;</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
<span class="cp">{%</span> <span class="k">for</span> <span class="nv">choice</span> <span class="k">in</span> <span class="nv">poll.choice_set.all</span> <span class="cp">%}</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;radio&quot;</span> <span class="na">name=</span><span class="s">&quot;choice&quot;</span> <span class="na">id=</span><span class="s">&quot;choice</span><span class="cp">{{</span> <span class="nb">forloop</span><span class="nv">.counter</span> <span class="cp">}}</span><span class="s">&quot;</span> <span class="na">value=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">choice.id</span> <span class="cp">}}</span><span class="s">&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;choice</span><span class="cp">{{</span> <span class="nb">forloop</span><span class="nv">.counter</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">choice.choice</span> <span class="cp">}}</span><span class="nt">&lt;/label&gt;&lt;br</span> <span class="nt">/&gt;</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">value=</span><span class="s">&quot;Vote&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre></div>
</div>
<p>Uma rápida explicação:</p>
<ul class="simple">
<li>O template acima exibe um botão radio para cada opção da enquete.  O
<tt class="docutils literal"><span class="pre">value</span></tt> de cada botão radio está associado ao ID da opção.  O <tt class="docutils literal"><span class="pre">name</span></tt>
de cada botão radio é a escolha (<tt class="docutils literal"><span class="pre">choice</span></tt>). Isso significa que, quando
alguém escolhe um dos botões de radio e submete a formulário, ele vai
enviar <tt class="docutils literal"><span class="pre">choice=3</span></tt> por POST. Este são os formulários HTML 101.</li>
<li>Nós definimos o parâmetro <tt class="docutils literal"><span class="pre">action</span></tt> do formulário para /polls/{{ poll.id
}}/vote/, e definimos <tt class="docutils literal"><span class="pre">method=post</span></tt>. Usando <tt class="docutils literal"><span class="pre">method=post</span></tt> (em vez de
<tt class="docutils literal"><span class="pre">method=get</span></tt>) é muito importante, porque o ato de enviar este
formulário irá alterar dados do lado servidor. Sempre que criar um
formulário que modifique os dados do lado do servidor, utilize
<tt class="docutils literal"><span class="pre">method=&quot;post&quot;</span></tt>. Esta dica não é específica do Django; mais sim uma boa
prática para o desenvolvimento é Web.</li>
<li><tt class="docutils literal"><span class="pre">forloop.counter</span></tt> indica quantas vezes a tag :ttag`for` atravessou o seu
ciclo.</li>
</ul>
<p>Agora, vamos criar uma <tt class="docutils literal"><span class="pre">view</span></tt> Django que manipula os dados submetidos e faz
algo com eles. Lembre-se, no <a class="reference internal" href="tutorial03.html#intro-tutorial03"><em>Tutorial 3</em></a>, criamos uma
URLconf para a aplicação de enquete que inclui esta linha:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="s">r&#39;^(?P&lt;poll_id&gt;\d+)/vote/$&#39;</span><span class="p">,</span> <span class="s">&#39;vote&#39;</span><span class="p">),</span>
</pre></div>
</div>
<p>Então, vamos criar um função <tt class="docutils literal"><span class="pre">vote()</span></tt> em <tt class="docutils literal"><span class="pre">mysite/polls/views.py</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">get_object_or_404</span><span class="p">,</span> <span class="n">render_to_response</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponseRedirect</span>
<span class="kn">from</span> <span class="nn">django.core.urlresolvers</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">from</span> <span class="nn">mysite.polls.models</span> <span class="kn">import</span> <span class="n">Choice</span><span class="p">,</span> <span class="n">Poll</span>
<span class="c"># ...</span>
<span class="k">def</span> <span class="nf">vote</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">poll_id</span><span class="p">):</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Poll</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">poll_id</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">selected_choice</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">choice_set</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;choice&#39;</span><span class="p">])</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="n">Choice</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">):</span>
        <span class="c"># Redisplay the poll voting form.</span>
        <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;polls/detail.html&#39;</span><span class="p">,</span> <span class="p">{</span>
            <span class="s">&#39;poll&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">,</span>
            <span class="s">&#39;error_message&#39;</span><span class="p">:</span> <span class="s">&quot;You didn&#39;t select a choice.&quot;</span><span class="p">,</span>
        <span class="p">})</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">selected_choice</span><span class="o">.</span><span class="n">votes</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">selected_choice</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="c"># Always return an HttpResponseRedirect after successfully dealing</span>
        <span class="c"># with POST data. This prevents data from being posted twice if a</span>
        <span class="c"># user hits the Back button.</span>
        <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s">&#39;mysite.polls.views.results&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">id</span><span class="p">,)))</span>
</pre></div>
</div>
<p>Este código inclui algumas coisas que ainda não foram cobertas neste tutorial:</p>
<ul>
<li><p class="first"><a class="reference internal" href="../ref/request-response.html#django.http.HttpRequest.POST" title="django.http.HttpRequest.POST"><tt class="xref py py-attr docutils literal"><span class="pre">request.POST</span></tt></a> é um objeto como
dicionários que lhe permite acessar os dados submetidos pelas suas chaves.
Neste caso, <tt class="docutils literal"><span class="pre">request.POST['choice']</span></tt> retorna o ID da opção selecionada,
tal como uma string. Os valores de <a class="reference internal" href="../ref/request-response.html#django.http.HttpRequest.POST" title="django.http.HttpRequest.POST"><tt class="xref py py-attr docutils literal"><span class="pre">request.POST</span></tt></a> são sempre strings.</p>
<p>Note que Django também fornece <a class="reference internal" href="../ref/request-response.html#django.http.HttpRequest.GET" title="django.http.HttpRequest.GET"><tt class="xref py py-attr docutils literal"><span class="pre">request.GET</span></tt></a> para acesar dados GET da mesma forma --
mas nós estamos usando <a class="reference internal" href="../ref/request-response.html#django.http.HttpRequest.POST" title="django.http.HttpRequest.POST"><tt class="xref py py-attr docutils literal"><span class="pre">request.POST</span></tt></a> explicitamente no nosso código, para
garantir que os dados só podem ser alterados por meio de uma chamada
POST.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">request.POST['choice']</span></tt> irá levantar a exceção <tt class="xref py py-exc docutils literal"><span class="pre">KeyError</span></tt> caso uma
<tt class="docutils literal"><span class="pre">choice</span></tt> não seja fornecida via POST. O código acima checa por
<tt class="xref py py-exc docutils literal"><span class="pre">KeyError</span></tt> e re-exibe o formulário da enquete com as mensagens de
erro se uma <tt class="docutils literal"><span class="pre">choice</span></tt> não for fornecida.</p>
</li>
<li><p class="first">Após incrementar uma opção, o código retorna um
<a class="reference internal" href="../ref/request-response.html#django.http.HttpResponseRedirect" title="django.http.HttpResponseRedirect"><tt class="xref py py-class docutils literal"><span class="pre">HttpResponseRedirect</span></tt></a> em vez de um normal
<a class="reference internal" href="../ref/request-response.html#django.http.HttpResponse" title="django.http.HttpResponse"><tt class="xref py py-class docutils literal"><span class="pre">HttpResponse</span></tt></a>.
<tt class="xref py py-class docutils literal"><span class="pre">HttpResponseRedirect`</span></tt> recebe um único argumento: a
URL para o qual o usuário será redirecionado (veja o ponto seguinte para
saber como construímos a URL, neste caso).</p>
<p>Como o comentário Python acima salienta, você deve sempre retornar uma
<a class="reference internal" href="../ref/request-response.html#django.http.HttpResponseRedirect" title="django.http.HttpResponseRedirect"><tt class="xref py py-class docutils literal"><span class="pre">HttpResponseRedirect</span></tt></a> depois de lidar com sucesso com
dados POST. Esta dica não é específica do Django; mais sim uma boa prática
para o desenvolvimento Web.</p>
</li>
<li><p class="first">Estamos usando a função <a class="reference internal" href="../topics/http/urls.html#django.core.urlresolvers.reverse" title="django.core.urlresolvers.reverse"><tt class="xref py py-func docutils literal"><span class="pre">reverse()</span></tt></a> no
construtor do <a class="reference internal" href="../ref/request-response.html#django.http.HttpResponseRedirect" title="django.http.HttpResponseRedirect"><tt class="xref py py-class docutils literal"><span class="pre">HttpResponseRedirect</span></tt></a> neste exemplo.
Essa função ajuda a evitar ter que escrever na mão a URL na função de
view. É dado o nome da view de que queremos passar o controle e uma
porção da variável do padrão de URL que aponta para essa view. Neste
caso, usando o URLConf criado no Tutorial 3, esta chamada a
<a class="reference internal" href="../topics/http/urls.html#django.core.urlresolvers.reverse" title="django.core.urlresolvers.reverse"><tt class="xref py py-func docutils literal"><span class="pre">reverse()</span></tt></a> irá retornar uma string como:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="s">&#39;/polls/3/results/&#39;</span>
</pre></div>
</div>
<p>... onde o <tt class="docutils literal"><span class="pre">3</span></tt> é o valor de <tt class="docutils literal"><span class="pre">p.id</span></tt>. Esta URL redirecionada irá então
chamar a view <tt class="docutils literal"><span class="pre">'results'</span></tt> afim de exibir a página final. Note que você
precisará usar o nome completo da <tt class="docutils literal"><span class="pre">view</span></tt> aqui (incluindo o prefixo).</p>
</li>
</ul>
<p>Como mencionado no Tutorial 3, <tt class="docutils literal"><span class="pre">request</span></tt> é um objeto
<a class="reference internal" href="../ref/request-response.html#django.http.HttpRequest" title="django.http.HttpRequest"><tt class="xref py py-class docutils literal"><span class="pre">HttpRequest</span></tt></a>. Para mais informações sobre o objeto
<a class="reference internal" href="../ref/request-response.html#django.http.HttpRequest" title="django.http.HttpRequest"><tt class="xref py py-class docutils literal"><span class="pre">HttpRequest</span></tt></a>, veja a <a class="reference internal" href="../ref/request-response.html#ref-request-response"><em>documentação do request e
response</em></a>.</p>
<p>Depois que alguém votar em uma enquete, a view <tt class="docutils literal"><span class="pre">vote()</span></tt>  redireciona para a
página de resultados da enquete. Vamos escrever essa <tt class="docutils literal"><span class="pre">view</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">results</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">poll_id</span><span class="p">):</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Poll</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">poll_id</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;polls/results.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;poll&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">})</span>
</pre></div>
</div>
<p>Isto é quase exatamente o mesmo que a view <tt class="docutils literal"><span class="pre">detail()</span></tt> do <a class="reference internal" href="tutorial03.html#intro-tutorial03"><em>Tutorial 3</em></a>. A única diferença é o nome do template. Iremos corrigir
esta redundância depois.</p>
<p>Agora, crie um template <tt class="docutils literal"><span class="pre">results.html</span></tt>:</p>
<div class="highlight-html+django"><div class="highlight"><pre><span class="nt">&lt;h1&gt;</span><span class="cp">{{</span> <span class="nv">poll.question</span> <span class="cp">}}</span><span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;ul&gt;</span>
<span class="cp">{%</span> <span class="k">for</span> <span class="nv">choice</span> <span class="k">in</span> <span class="nv">poll.choice_set.all</span> <span class="cp">%}</span>
    <span class="nt">&lt;li&gt;</span><span class="cp">{{</span> <span class="nv">choice.choice</span> <span class="cp">}}</span> -- <span class="cp">{{</span> <span class="nv">choice.votes</span> <span class="cp">}}</span> vote<span class="cp">{{</span> <span class="nv">choice.votes</span><span class="o">|</span><span class="nf">pluralize</span> <span class="cp">}}</span><span class="nt">&lt;/li&gt;</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
<span class="nt">&lt;/ul&gt;</span>
</pre></div>
</div>
<p>Agora, vá para <tt class="docutils literal"><span class="pre">/polls/1/</span></tt> no seu navegador e vote em uma enquete. Você deverá
ver uma página de resultados que será atualizado cada vez que você votar. Se
você enviar o formulário sem ter escolhido uma opção, você deverá ver a mensagem
de erro.</p>
</div>
<div class="section" id="s-use-views-genericas-menos-codigo-e-melhor">
<span id="use-views-genericas-menos-codigo-e-melhor"></span><h2>Use views genéricas: Menos código é melhor<a class="headerlink" href="#use-views-genericas-menos-codigo-e-melhor" title="Permalink to this headline">¶</a></h2>
<p>As views <tt class="docutils literal"><span class="pre">detail()</span></tt> (do <a class="reference internal" href="tutorial03.html#intro-tutorial03"><em>Tutorial 3</em></a>) e <tt class="docutils literal"><span class="pre">results()</span></tt>
são estupidamente simples -- e, como já mencionado acima, são redundantes.  A
view, <tt class="docutils literal"><span class="pre">index()</span></tt> (também do Tutorial 3), que exibe uma lista de enquetes, é
semelhante.</p>
<p>Estas views representam um caso comum do desenvolvimento Web básico: obter
dados do banco de dados de acordo com um parâmetro passado na URL, carregar um
template e devolvê-lo renderizado. Por isto ser muito comum, o Django fornece
um atalho, chamado sistema de &quot;views genéricas&quot;.</p>
<p>Views genéricas abstraem padrões comuns para um ponto onde você nem precisa
escrever código Python para escrever uma aplicação.</p>
<p>Vamos converter a nossa aplicação de enquete para utilizar o sistema de views
genéricas, por isso podemos excluir um monte do nosso próprio código. Iremos
apenas ter que executar alguns passos para fazer a conversão. Nós iremos:</p>
<ol class="arabic simple">
<li>Converter a URLconf.</li>
<li>Renomear alguns templates.</li>
<li>Remover algumas views antigas e desnecessárias.</li>
<li>Corrigir a manipulação de URL para as novas views.</li>
</ol>
<p>Leia a respeito para obter mais detalhes.</p>
<div class="admonition-por-que-o-codigo-se-arrastou admonition ">
<p class="first admonition-title">Por que o código se arrastou?</p>
<p>Geralmente, quando estiver escrevendo uma aplicação Django, você vai avaliar
se views genéricas são uma escolha adequada para o seu problema e você irá
utilizá-las desde o início em vez de refatorar seu código no meio do
caminho. Mas este tutorial intencionalmente tem focado em escrever views &quot;do
jeito mais difícil&quot; até agora, para concentrarmos nos conceitos
fundamentais.</p>
<p class="last">Você deve saber matemática básica antes de você começar a usar uma
calculadora.</p>
</div>
<p>Em primeiro lugar, abra a URLconf <tt class="docutils literal"><span class="pre">polls/urls.py</span></tt>. Ela esta assim, de acordo
com o tutorial até o momento:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.conf.urls.defaults</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;mysite.polls.views&#39;</span><span class="p">,</span>
    <span class="p">(</span><span class="s">r&#39;^$&#39;</span><span class="p">,</span> <span class="s">&#39;index&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s">r&#39;^(?P&lt;poll_id&gt;\d+)/$&#39;</span><span class="p">,</span> <span class="s">&#39;detail&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s">r&#39;^(?P&lt;poll_id&gt;\d+)/results/$&#39;</span><span class="p">,</span> <span class="s">&#39;results&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s">r&#39;^(?P&lt;poll_id&gt;\d+)/vote/$&#39;</span><span class="p">,</span> <span class="s">&#39;vote&#39;</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Modifique para ficar assim:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.conf.urls.defaults</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">mysite.polls.models</span> <span class="kn">import</span> <span class="n">Poll</span>

<span class="n">info_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;queryset&#39;</span><span class="p">:</span> <span class="n">Poll</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
<span class="p">}</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
    <span class="p">(</span><span class="s">r&#39;^$&#39;</span><span class="p">,</span> <span class="s">&#39;django.views.generic.list_detail.object_list&#39;</span><span class="p">,</span> <span class="n">info_dict</span><span class="p">),</span>
    <span class="p">(</span><span class="s">r&#39;^(?P&lt;object_id&gt;\d+)/$&#39;</span><span class="p">,</span> <span class="s">&#39;django.views.generic.list_detail.object_detail&#39;</span><span class="p">,</span> <span class="n">info_dict</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^(?P&lt;object_id&gt;\d+)/results/$&#39;</span><span class="p">,</span> <span class="s">&#39;django.views.generic.list_detail.object_detail&#39;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">info_dict</span><span class="p">,</span> <span class="n">template_name</span><span class="o">=</span><span class="s">&#39;polls/results.html&#39;</span><span class="p">),</span> <span class="s">&#39;poll_results&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s">r&#39;^(?P&lt;poll_id&gt;\d+)/vote/$&#39;</span><span class="p">,</span> <span class="s">&#39;mysite.polls.views.vote&#39;</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Nós estamos usando duas views genéricas aqui:
<tt class="xref py py-func docutils literal"><span class="pre">object_list()</span></tt> e
<tt class="xref py py-func docutils literal"><span class="pre">object_list()</span></tt>. Respectivamente, essas
duas <tt class="docutils literal"><span class="pre">views</span></tt> abstraem o conceito de exibir uma lista de objetos e exibir uma
página de detalhe para um tipo particular de objeto.</p>
<ul class="simple">
<li>Cada view genérica precisa saber qual tipo de dado ela vai agir em cima.
Esses dados são fornecidos em um dicionário. A chave <tt class="docutils literal"><span class="pre">queryset</span></tt> neste
dicionário aponta para a lista de objetos a serem manipulados pela view
genérica.</li>
<li>A view genérica <tt class="xref py py-func docutils literal"><span class="pre">object_detail()</span></tt>
espera o valor ID capturado da URL em <tt class="docutils literal"><span class="pre">&quot;object_id&quot;</span></tt>, de modo que
alteramos <tt class="docutils literal"><span class="pre">poll_id</span></tt> para <tt class="docutils literal"><span class="pre">object_id</span></tt> para as views genérica.</li>
<li>Nós adicionamos um nome, <tt class="docutils literal"><span class="pre">poll_results</span></tt>, para os resultados da view
assim nós temos uma maneira de se referir à sua URL depois (veja a
documentação sobre <a class="reference internal" href="../topics/http/urls.html#naming-url-patterns"><em>naming URL patterns</em></a> para
informações).  Também estamos usando a função
<tt class="xref py py-func docutils literal"><span class="pre">url()</span></tt> de <tt class="xref py py-mod docutils literal"><span class="pre">django.conf.urls.defaults</span></tt>
aqui. É um bom hábito usar <tt class="xref py py-func docutils literal"><span class="pre">url()</span></tt> quando
você estiver fornecendo um padrão de nome como este.</li>
</ul>
<p>Por padrão, a view genérica
<tt class="xref py py-func docutils literal"><span class="pre">object_detail()</span></tt> utiliza um template
chamado <tt class="docutils literal"><span class="pre">&lt;app</span> <span class="pre">name&gt;/&lt;model</span> <span class="pre">name&gt;_detail.html</span></tt>. Em nosso caso, ela vai
utilizar o template <tt class="docutils literal"><span class="pre">&quot;polls/poll_detail.html&quot;</span></tt>. Assim, renomeie o seu
template <tt class="docutils literal"><span class="pre">polls/detail.html</span></tt> para <tt class="docutils literal"><span class="pre">polls/poll_detail.html</span></tt> e altere a linha
<tt class="xref py py-func docutils literal"><span class="pre">render_to_response</span> <span class="pre">em</span> <span class="pre">``vote()`()</span></tt>.</p>
<p>Semelhantemente, a view genérica
<tt class="xref py py-func docutils literal"><span class="pre">object_list()</span></tt> utiliza um template
chamado <tt class="docutils literal"><span class="pre">&lt;app</span> <span class="pre">name&gt;/&lt;model</span> <span class="pre">name&gt;_list.html</span></tt>. Assim, renomeie
<tt class="docutils literal"><span class="pre">polls/index.html</span></tt> para <tt class="docutils literal"><span class="pre">polls/poll_list.html</span></tt>.</p>
<p>Por termos mais de uma entrada na URLconf que usa
<tt class="xref py py-func docutils literal"><span class="pre">object_detail()</span></tt> para a aplicação de
enquete, nós especificamos manualmente um nome para a view de resultados:
<tt class="docutils literal"><span class="pre">template_name='polls/results.html'</span></tt>. Caso contrário, as duas views
utilizariam o mesmo template. Note que nós usamos <tt class="docutils literal"><span class="pre">dict()</span></tt> para retornar um
dicionário alterado no lugar.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><tt class="xref py py-meth docutils literal"><span class="pre">django.db.models.QuerySet.all()</span></tt> é preguiçosa</p>
<p>Poderá parecer um pouco assustador ver <tt class="docutils literal"><span class="pre">Poll.objects.all()</span></tt> ser utilizado
na view de detalhe que necessita apenas de um objeto <tt class="docutils literal"><span class="pre">Poll</span></tt> mas não se
preocupe; <tt class="docutils literal"><span class="pre">Poll.objects.all()</span></tt> é na verdade um objeto especial chamado de
<a class="reference internal" href="../ref/models/querysets.html#django.db.models.QuerySet" title="django.db.models.QuerySet"><tt class="xref py py-class docutils literal"><span class="pre">QuerySet</span></tt></a>, que é &quot;preguiçosa&quot; e não toca no seu
banco de dados a menos que seja absolutamente necessário. No momento em que
a consulta ao banco de dados acontecer, a view genérica
<tt class="xref py py-func docutils literal"><span class="pre">object_detail()</span></tt> terá limitado o seu
escopo para um único objeto, de modo que a eventual consulta só irá
selecionar uma linha da base de dados.</p>
<p class="last">Se você quiser saber mais sobre seu funcionamento, a documentação de banco
de dados do Django <a class="reference internal" href="../topics/db/queries.html#querysets-are-lazy"><em>explica a natureza preguiçosa dos abjetos QuerySet</em></a>.</p>
</div>
<p>Nas partes anteriores deste tutorial, os templates tem sido fornecidos com um
<tt class="docutils literal"><span class="pre">context</span></tt> que contém as variáveis de contexto <cite>poll`</cite> e <tt class="docutils literal"><span class="pre">latest_poll_list</span></tt>.
No entanto, as views genérica fornecem as variáveis <tt class="docutils literal"><span class="pre">object</span></tt> e
<tt class="docutils literal"><span class="pre">object_list</span></tt> como contexto. Portanto, você precisa mudar seus templates para
combinar com as novas variáveis de contexto. Vá através de seus templates, e
altere qualquer referência a <tt class="docutils literal"><span class="pre">latest_poll_list</span></tt> para <tt class="docutils literal"><span class="pre">object_list</span></tt> e altere
qualquer referência de <tt class="docutils literal"><span class="pre">poll</span></tt> para <tt class="docutils literal"><span class="pre">object</span></tt>.</p>
<p>Agora você pode deletar as views, <tt class="docutils literal"><span class="pre">index()</span></tt>, <tt class="docutils literal"><span class="pre">detail()</span></tt> e <tt class="docutils literal"><span class="pre">results()</span></tt>
do arquivo <tt class="docutils literal"><span class="pre">polls/views.py</span></tt>.  Não precisamos delas mais -- elas foram
substituídas por views genéricas.</p>
<p>A view <tt class="docutils literal"><span class="pre">vote()</span></tt> ainda é necessária. No entanto, ela deve ser modificada para
corresponder ao novo contexto de variáveis. Na chamada
<tt class="xref py py-func docutils literal"><span class="pre">render_to_response()</span></tt>, renomeie a variável de contexto
de <tt class="docutils literal"><span class="pre">poll</span></tt> para <tt class="docutils literal"><span class="pre">object</span></tt>.</p>
<p>A última coisa a fazer é corrigir o manipulador da URL para levar em conta a
utilização de views genéricas. Na view <tt class="docutils literal"><span class="pre">vote()</span></tt> acima, usamos a função
<a class="reference internal" href="../topics/http/urls.html#django.core.urlresolvers.reverse" title="django.core.urlresolvers.reverse"><tt class="xref py py-func docutils literal"><span class="pre">reverse()</span></tt></a> para evitar escrever na mão nossas
URLs. Agora que mudamos para view genérica, nós vamos precisar alterar a
chamada <a class="reference internal" href="../topics/http/urls.html#django.core.urlresolvers.reverse" title="django.core.urlresolvers.reverse"><tt class="xref py py-func docutils literal"><span class="pre">reverse()</span></tt></a> para apontar de volta para a
nossa nova view genérica. Nós não podemos simplesmente utilizar a função view
mais -- views genéricas podem ser (e são) utilizada várias vezes - mas podemos
usar o nome que foi dado:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s">&#39;poll_results&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">id</span><span class="p">,)))</span>
</pre></div>
</div>
<p>Execute o servidor e use sua nova aplicação de enquete baseada em views
genéricas.</p>
<p>Para maiores detalhes sobre views genéricas, consulte a <a class="reference internal" href="../topics/http/generic-views.html#topics-http-generic-views"><em>documentação
sobre views genéricas</em></a>.</p>
</div>
<div class="section" id="s-brevemente">
<span id="brevemente"></span><h2>Brevemente<a class="headerlink" href="#brevemente" title="Permalink to this headline">¶</a></h2>
<p>O tutorial acaba aqui por enquanto. Futuras partes deste tutorial cobrirão:</p>
<ul class="simple">
<li>Processamento avançado de formulário</li>
<li>Usando o framework de RSS</li>
<li>Usando o framework de cache</li>
<li>Usando o framework de comentários</li>
<li>Características avançadas da interface de administração: Permissões</li>
<li>Características avançadas da interface de administração: JavaScript
personalizado</li>
</ul>
<p>Por enquanto, você pode querer verificar alguns pontos em <a class="reference internal" href="whatsnext.html#intro-whatsnext"><em>para onde ir a
partir daqui</em></a></p>
</div>
</div>


          </div>         
        </div>
      </div>
      
        
          <div class="yui-b" id="sidebar">
            
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../contents.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Escrevendo sua primeira aplicação Django, parte 4</a><ul>
<li><a class="reference internal" href="#escreva-um-simples-formulario">Escreva um simples formulário</a></li>
<li><a class="reference internal" href="#use-views-genericas-menos-codigo-e-melhor">Use views genéricas: Menos código é melhor</a></li>
<li><a class="reference internal" href="#brevemente">Brevemente</a></li>
</ul>
</li>
</ul>

  <h3>Browse</h3>
  <ul>
    
      <li>Prev: <a href="tutorial03.html">Escrevendo sua primeira aplicação Django, parte 3</a></li>
    
    
      <li>Next: <a href="whatsnext.html">What to read next</a></li>
    
  </ul>
  <h3>Você está aqui:</h3>
  <ul>
      <li>
        <a href="../index.html">Django v1.3.1 documentation</a>
        
          <ul><li><a href="index.html">Primeiros passos</a>
        
        <ul><li>Escrevendo sua primeira aplicação Django, parte 4</li></ul>
        </li></ul>
      </li>
  </ul>  

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/intro/tutorial04.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
              <h3>Última atualização:</h3>
              <p class="topless">Dec 06, 2011</p>
          </div> 
        
      
    </div>
    
    <div id="ft">
      <div class="nav">
    &laquo; <a href="tutorial03.html" title="Escrevendo sua primeira aplicação Django, parte 3">previous</a> 
     |
    <a href="index.html" title="Primeiros passos" accesskey="U">up</a>
   |
    <a href="whatsnext.html" title="What to read next">next</a> &raquo;</div>
    </div>
  </div>

      <div class="clearer"></div>
    </div>
  </body>
</html>