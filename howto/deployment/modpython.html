
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Como usar o Django com o Apache e mod_python &mdash; Django v1.3.1 documentation</title>
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.3.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="Django v1.3.1 documentation" href="../../index.html" />
    <link rel="up" title="Implantando o Django" href="index.html" />
    <link rel="next" title="Reporte de erros via e-mail" href="../error-reporting.html" />
    <link rel="prev" title="Como usar o Django com FastCGI, SCGI ou AJP" href="fastcgi.html" />
 
<script type="text/javascript" src="../../templatebuiltins.js"></script>
<script type="text/javascript">
(function($) {
    if (!django_template_builtins) {
       // templatebuiltins.js missing, do nothing.
       return;
    }
    $(document).ready(function() {
        // Hyperlink Django template tags and filters
        var base = "../../ref/templates/builtins.html";
        if (base == "#") {
            // Special case for builtins.html itself
            base = "";
        }
        // Tags are keywords, class '.k'
        $("div.highlight\\-html\\+django span.k").each(function(i, elem) {
             var tagname = $(elem).text();
             if ($.inArray(tagname, django_template_builtins.ttags) != -1) {
                 var fragment = tagname.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + tagname + "</a>");
             }
        });
        // Filters are functions, class '.nf'
        $("div.highlight\\-html\\+django span.nf").each(function(i, elem) {
             var filtername = $(elem).text();
             if ($.inArray(filtername, django_template_builtins.tfilters) != -1) {
                 var fragment = filtername.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + filtername + "</a>");
             }
        });
    });
})(jQuery);
</script>

  </head>
  <body>

    <div class="document">
  <div id="custom-doc" class="yui-t6">
    <div id="hd">
      <h1><a href="../../index.html">Django v1.3.1 documentation</a></h1>
      <div id="global-nav">
        <a title="Home page" href="../../index.html">Home</a>  |
        <a title="Tabela de conteúdos" href="../../contents.html">Tabela de conteúdos</a>  |
        <a title="Índice Global" href="../../genindex.html">Índice</a>  |
        <a title="Busca" href="../../py-modindex.html">Módulos</a>
      </div>
      <div class="nav">
    &laquo; <a href="fastcgi.html" title="Como usar o Django com FastCGI, SCGI ou AJP">previous</a> 
     |
    <a href="../index.html" title="Guias &amp;#8220;como fazer&amp;#8221;" accesskey="U">up</a>
   |
    <a href="../error-reporting.html" title="Reporte de erros via e-mail">next</a> &raquo;</div>
    </div>
    
    <div id="bd">
      <div id="yui-main">
        <div class="yui-b">
          <div class="yui-g" id="howto-deployment-modpython">
            
  <div class="section" id="s-como-usar-o-django-com-o-apache-e-mod-python">
<span id="como-usar-o-django-com-o-apache-e-mod-python"></span><h1>Como usar o Django com o Apache e mod_python<a class="headerlink" href="#como-usar-o-django-com-o-apache-e-mod-python" title="Permalink to this headline">¶</a></h1>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Support for mod_python has been deprecated, and will be removed in
Django 1.5. If you are configuring a new deployment, you are
strongly encouraged to consider using <a class="reference internal" href="modwsgi.html"><em>mod_wsgi</em></a> or any of the other <a class="reference internal" href="index.html"><em>supported
backends</em></a>.</p>
</div>
<p>O módulo <a class="reference external" href="http://www.modpython.org/">mod_python</a> para o <a class="reference external" href="http://httpd.apache.org/">Apache</a> pode ser usado para fazer a implantação
do Django em um servidor de produção, embora ele tenha sido praticamente superado pela opção
mais simples <a class="reference internal" href="modwsgi.html"><em>implantação com mod_wsgi</em></a>.</p>
<p>O mod_python é semelhante (e inspirado) ao <a class="reference external" href="http://perl.apache.org/">mod_perl</a> : Ele embute o Python dentro
do Apache e carrega o código Python na memória quando o servidor inicia. o Código fica na memória
durante o tempo de vida do processo Apache, que leva a ganhos de performance
significantes sobre outras opções de disposição de servidor.</p>
<p>O Django requer o Apache 2.x e o mod_python 3.x, e você deve usar o
<a class="reference external" href="http://httpd.apache.org/docs/2.2/mod/prefork.html">MPM prefork</a>, ao invés do <a class="reference external" href="http://httpd.apache.org/docs/2.2/mod/worker.html">MPM worker</a>.</p>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<ul class="last simple">
<li>O apache é um animal grande e complexo, e esse documento dá apenas um
panorama do que o Apache é capaz de fazer. Se você precisa de informação
mais avançado sobre o Apache, não há fonte de informação melhor que
<a class="reference external" href="http://httpd.apache.org/docs/">a própria documentação oficial do Apache</a></li>
<li>Você pode também estar interessado em <a class="reference internal" href="fastcgi.html"><em>Como usar o Django com FastCGI, SCGI
ou AJP</em></a>.</li>
</ul>
</div>
<div class="section" id="s-configuracao-basica">
<span id="configuracao-basica"></span><h2>Configuração Básica<a class="headerlink" href="#configuracao-basica" title="Permalink to this headline">¶</a></h2>
<p>Para configurar o Django com o mod_python, verifique primeiro se você tem o Apache instalado,
Com o módulo mod_python ativado.</p>
<p>Edite o arquivo <tt class="docutils literal"><span class="pre">httpd.conf</span></tt> e adicione o seguinte:</p>
<div class="highlight-apache"><div class="highlight"><pre><span class="nt">&lt;Location</span> <span class="s">&quot;/mysite/&quot;</span><span class="nt">&gt;</span>
    <span class="nb">SetHandler</span> python-program
    <span class="nb">PythonHandler</span> django.core.handlers.modpython
    <span class="nb">SetEnv</span> DJANGO_SETTINGS_MODULE mysite.settings
    <span class="nb">PythonOption</span> django.root <span class="sx">/mysite</span>
    <span class="nb">PythonDebug</span> <span class="k">On</span>
<span class="nt">&lt;/Location&gt;</span>
</pre></div>
</div>
<p>...e substitua o <tt class="docutils literal"><span class="pre">mysite.settings</span></tt> com o caminho de importação do Python para o seu
arquivo de configuração do projeto Django.</p>
<p>Isso diz ao Apache: &quot;Use o mod_python para qualquer URL em ou sobre '/mysite/', usando o
handler do mod_python do Django.&quot; Ele passa o valor do <a class="reference internal" href="../../topics/settings.html#django-settings-module"><em>DJANGO_SETTINGS_MODULE</em></a> para que o mod_python saiba quais configurações usar.</p>
<p>Como o mod_python não sabe que estamos servido
esse site a partir do prefixo <tt class="docutils literal"><span class="pre">/mysite/</span></tt>, esse valor precisa ser passado
para o Django através do manipulador do mod_python, pela linha <tt class="docutils literal"><span class="pre">PythonOption</span>
<span class="pre">django.root</span> <span class="pre">...</span></tt>. O valor configurado nessa linha (o último item) deve ser igual
ao texto informado na diretiva <tt class="docutils literal"><span class="pre">&lt;Location</span> <span class="pre">...&gt;</span></tt>. O efeito disso é que o
Django irá automaticamente remover a string <tt class="docutils literal"><span class="pre">/mysite</span></tt> no início de quaisquer
URLs antes de fazer a verificação deles com os seus padrões em <tt class="docutils literal"><span class="pre">URLConf</span></tt>. Se você depois
mudar o seu site para um endereço como <tt class="docutils literal"><span class="pre">/mysite2</span></tt>, você não irá precisar alterar nada,
exceto a opção <tt class="docutils literal"><span class="pre">django.root</span></tt> no arquivo de configuração.</p>
<p>Ao usar o <tt class="docutils literal"><span class="pre">django.root</span></tt> você deve assegurar-se que o que resta, após a
remoção do prefixo, inicie com uma barra. Seus padrões do URLConf que esperar
uma barra inicial funcionaram corretamente. No exemplo acima,
supondo que queiramos enviar uma URL como <tt class="docutils literal"><span class="pre">/mysite/admin/</span></tt> para o <tt class="docutils literal"><span class="pre">/admin/</span></tt>, precisamos
remover a  string <tt class="docutils literal"><span class="pre">/mysite</span></tt> do início, então esse deve ser o valor do
<tt class="docutils literal"><span class="pre">django.root</span></tt>. Seria um error usar o <tt class="docutils literal"><span class="pre">/mysite/</span></tt> (com uma
barra final) nesse caso.</p>
<p>Repare que estamos usando a diretiva <tt class="docutils literal"><span class="pre">&lt;Location&gt;</span></tt> , não a diretiva <tt class="docutils literal"><span class="pre">&lt;Directory&gt;</span></tt>.
Essa última é usada para apontar para lugares no sistema de arquivos,
enquanto <tt class="docutils literal"><span class="pre">&lt;Location&gt;</span></tt> aponta para lugares específicos na estrutura de URL de um Web site.
<tt class="docutils literal"><span class="pre">&lt;Directory&gt;</span></tt> seria sem significado aqui.</p>
<p>Além disso, se o seu projeto Django não está no <tt class="docutils literal"><span class="pre">PYTHONPATH</span></tt> padrão do seu
computador, você terá de dizer ao mod_python onde o seu projeto pode ser encontrado:</p>
<pre class="literal-block">
&lt;Location &quot;/mysite/&quot;&gt;
    SetHandler python-program
    PythonHandler django.core.handlers.modpython
    SetEnv DJANGO_SETTINGS_MODULE mysite.settings
    PythonOption django.root /mysite
    PythonDebug On
    <strong>PythonPath &quot;['/path/to/project'] + sys.path&quot;</strong>
&lt;/Location&gt;
</pre>
<p>O valor usado em <tt class="docutils literal"><span class="pre">PythonPath</span></tt> deve incluir o diretório pai de todos os módulos
que você vai importar em sua aplicação. Deve também incluir o
diretório pai da localização do <a class="reference internal" href="../../topics/settings.html#django-settings-module"><em>DJANGO_SETTINGS_MODULE</em></a>. Essa é exatamente a mesma situação
do caminho do Python para uso iterativo. Sempre que você tenta importar algo,
o Python irá percorrer todos os diretórios no <tt class="docutils literal"><span class="pre">sys.path</span></tt> em ordem,
do primeiro ao último, e tentar importar de cada diretório até ter sucesso.</p>
<p>Verique se as permissões dos seus arquivos de código Python estejam configuradas de forma que o usuário do
Apache  (normalmente chamado de <tt class="docutils literal"><span class="pre">apache</span></tt> ou <tt class="docutils literal"><span class="pre">httpd</span></tt> na maioria dos sistemas) tenha acesso
de leitura aos arquivos.</p>
<p>Um exemplo que pode tornar isso mais claro: suponha que você tenha algumas aplicações em
<tt class="docutils literal"><span class="pre">/usr/local/django-apps/</span></tt> (por exemplo, <tt class="docutils literal"><span class="pre">/usr/local/django-apps/weblog/</span></tt> e assim
por diante), seu arquivo de configurações está em <tt class="docutils literal"><span class="pre">/var/www/mysite/settings.py</span></tt> e você tem o
<a class="reference internal" href="../../topics/settings.html#django-settings-module"><em>DJANGO_SETTINGS_MODULE</em></a> especificado como no exemplo
acima. Nesse caso, você precisa escrever a sua diretiva <tt class="docutils literal"><span class="pre">PythonPath</span></tt> assim:</p>
<div class="highlight-apache"><div class="highlight"><pre><span class="nb">PythonPath</span> <span class="s2">&quot;[&#39;/usr/local/django-apps/&#39;, &#39;/var/www&#39;] + sys.path&quot;</span>
</pre></div>
</div>
<p>Com esse caminho, <tt class="docutils literal"><span class="pre">import</span> <span class="pre">weblog</span></tt> e <tt class="docutils literal"><span class="pre">import</span> <span class="pre">mysite.settings</span></tt> irão funcionar.
Se você tem <tt class="docutils literal"><span class="pre">import</span> <span class="pre">blogroll</span></tt> em algum lugar do seu código e <tt class="docutils literal"><span class="pre">blogroll</span></tt>
está no diretório <tt class="docutils literal"><span class="pre">weblog/</span></tt>, você <em>também</em> precisa adicionar
<tt class="docutils literal"><span class="pre">/usr/local/django-apps/weblog/</span></tt> ao seu <tt class="docutils literal"><span class="pre">PythonPath</span></tt>. Lembre-se: os
<strong>diretórios pai</strong> de tudo o que você for importar diretamente devem estar no caminho do
Python.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Se você está usando o Windoes, ainda assim recomendamos que você use barras normais
nos nome dos caminhos, ainda que o Windows normalmente use as barras invertidas
como seu separador nativo. O Apache sabe como converter a barra para o formato
nativo, então esse jeito de lidar é mais portável e mais fácil de ler.
(E evida problemas esquisitos como ter de escapar as barras invertidas duas
vezes.)</p>
<p>Isso é válido mesmo em um sistema Windows:</p>
<div class="last highlight-apache"><div class="highlight"><pre><span class="nb">PythonPath</span> <span class="s2">&quot;[&#39;c:/path/to/project&#39;] + sys.path&quot;</span>
</pre></div>
</div>
</div>
<p>Você também pode adicionar diretivas como <tt class="docutils literal"><span class="pre">PythonAutoReload</span> <span class="pre">Off</span></tt> para performance.
Veja a <a class="reference external" href="http://modpython.org/live/current/doc-html/directives.html">documentação do mod_python</a> para uma lista completa de opções.</p>
<p>Note que você deve configurar <tt class="docutils literal"><span class="pre">PythonDebug</span> <span class="pre">Off</span></tt> em um servidor de produção. Se você
deixar o <tt class="docutils literal"><span class="pre">PythonDebug</span> <span class="pre">On</span></tt>, seus usuários vão ver tracebacks Python feios (e reveladores)
se algo der errado dentro do mod_python.</p>
<p>Reinicie o Apache, e quaisquer requisições feitas para <tt class="docutils literal"><span class="pre">/mysite/</span></tt> ou abaixo dele serão servidas pelo
Django. Note que as URLconfs do Django não não eliminar o &quot;/mysite/&quot; -- elas recebem a URL
completa.</p>
<p>Ao implantar sites Django no mod_python, você irá precisar reiniciar o Apache a cada
vez que você fizer mudanças no seu código Python.</p>
</div>
<div class="section" id="s-multiplas-instalacoes-do-django-no-mesmo-apache">
<span id="multiplas-instalacoes-do-django-no-mesmo-apache"></span><h2>Múltiplas instalações do Django no mesmo Apache<a class="headerlink" href="#multiplas-instalacoes-do-django-no-mesmo-apache" title="Permalink to this headline">¶</a></h2>
<p>É inteiramente possível executar múltiplas instalações do Django na mesma instância do Apache.
Apenas use <tt class="docutils literal"><span class="pre">VirtualHost</span></tt> para isso, assim so:</p>
<div class="highlight-apache"><div class="highlight"><pre><span class="nb">NameVirtualHost</span> *

<span class="nt">&lt;VirtualHost</span> <span class="s">*</span><span class="nt">&gt;</span>
    <span class="nb">ServerName</span> www.example.com
    <span class="c"># ...</span>
    <span class="nb">SetEnv</span> DJANGO_SETTINGS_MODULE mysite.settings
<span class="nt">&lt;/VirtualHost&gt;</span>

<span class="nt">&lt;VirtualHost</span> <span class="s">*</span><span class="nt">&gt;</span>
    <span class="nb">ServerName</span> www2.example.com
    <span class="c"># ...</span>
    <span class="nb">SetEnv</span> DJANGO_SETTINGS_MODULE mysite.other_settings
<span class="nt">&lt;/VirtualHost&gt;</span>
</pre></div>
</div>
<p>Se você precisa colocar duas instalações do Django dentro do mesmo <tt class="docutils literal"><span class="pre">VirtualHost</span></tt>
(ou em blocos <tt class="docutils literal"><span class="pre">VirtualHost</span></tt> diferentes que compartilham o mesmo nome de servidor),
você precisará tomar um cuidade especial para que o cache do mod_python não
bagunce as coisas. Use a diretiva <tt class="docutils literal"><span class="pre">PythonInterpreter</span></tt> para dar a cada diretiva
<tt class="docutils literal"><span class="pre">&lt;Location&gt;</span></tt> diferente interpretadores separados:</p>
<div class="highlight-apache"><div class="highlight"><pre><span class="nt">&lt;VirtualHost</span> <span class="s">*</span><span class="nt">&gt;</span>
    <span class="nb">ServerName</span> www.example.com
    <span class="c"># ...</span>
    <span class="nt">&lt;Location</span> <span class="s">&quot;/something&quot;</span><span class="nt">&gt;</span>
        <span class="nb">SetEnv</span> DJANGO_SETTINGS_MODULE mysite.settings
        <span class="nb">PythonInterpreter</span> mysite
    <span class="nt">&lt;/Location&gt;</span>

    <span class="nt">&lt;Location</span> <span class="s">&quot;/otherthing&quot;</span><span class="nt">&gt;</span>
        <span class="nb">SetEnv</span> DJANGO_SETTINGS_MODULE mysite.other_settings
        <span class="nb">PythonInterpreter</span> othersite
    <span class="nt">&lt;/Location&gt;</span>
<span class="nt">&lt;/VirtualHost&gt;</span>
</pre></div>
</div>
<p>Os valores para <tt class="docutils literal"><span class="pre">PythonInterpreter</span></tt> não importam muito, desde que eles sejam diferentes
entre os blocos <tt class="docutils literal"><span class="pre">Location</span></tt>.</p>
</div>
<div class="section" id="s-executando-um-servidor-de-desenvolvimento-com-o-mod-python">
<span id="executando-um-servidor-de-desenvolvimento-com-o-mod-python"></span><h2>Executando um servidor de desenvolvimento com o mod_python<a class="headerlink" href="#executando-um-servidor-de-desenvolvimento-com-o-mod-python" title="Permalink to this headline">¶</a></h2>
<p>Se você usar o mod_python como seu servidor de desenvolvimento, você pode evitar o fardo
de ter de reiniciar o servidor cada vez que seu código muda. Apenas configure
<tt class="docutils literal"><span class="pre">MaxRequestsPerChild</span> <span class="pre">1</span></tt> no seu arquivo <tt class="docutils literal"><span class="pre">httpd.conf</span></tt> para forçar o Apache a recarregar
tudo de novo em cada requisição. Mas não faça isso no servidor de produção, ou revogaremos
seus privilégios Django.</p>
<p>Se você é o tipo de programador que debuga disperando declarações <tt class="docutils literal"><span class="pre">print</span></tt>
no meio do seu código, note que declarações <tt class="docutils literal"><span class="pre">print</span></tt> não aparecem no log do Apache
e podem até mesmo <a class="reference external" href="http://blog.dscpl.com.au/2009/04/wsgi-and-printing-to-standard-output.html">causar erros de resposta</a>.</p>
<p>Se você precisa imprimir informação de depuração em uma configuração com o mod_python, você
tem algumas opções. You can print to <tt class="docutils literal"><span class="pre">stderr</span></tt> explicitly, like so:</p>
<div class="highlight-apache"><pre>print &gt;&gt; sys.stderr, 'debug text'
sys.stderr.flush()</pre>
</div>
<p>(note that <tt class="docutils literal"><span class="pre">stderr</span></tt> is buffered, so calling <tt class="docutils literal"><span class="pre">flush</span></tt> is necessary if you wish
debugging information to be displayed promptly.)</p>
<p>A more compact approach is to use an assertion:</p>
<div class="highlight-apache"><div class="highlight"><pre><span class="nb">assert</span> False, &#39;debug text&#39;
</pre></div>
</div>
<p>Outra alternativa é adicionar a informação de debug no template da sua página.</p>
</div>
<div class="section" id="s-servindo-arquivos-de-midia">
<span id="servindo-arquivos-de-midia"></span><h2>Servindo arquivos de mídia<a class="headerlink" href="#servindo-arquivos-de-midia" title="Permalink to this headline">¶</a></h2>
<p>O Django não serve arquivos de mídia por si só; ele delega esse trabalho ao servidor Web
de sua escolha.</p>
<p>Nós recomendanos o uso de um servidor Web separado -- i.e., um que não esteja executando o
Django -- para servir mídia. Aqui estão algumas boas escolhas:</p>
<ul class="simple">
<li><a class="reference external" href="http://www.lighttpd.net/">lighttpd</a></li>
<li><a class="reference external" href="http://wiki.nginx.org/Main">Nginx</a></li>
<li><a class="reference external" href="http://en.wikipedia.org/wiki/TUX_web_server">TUX</a></li>
<li>Uma versão reduzida do <a class="reference external" href="http://httpd.apache.org/">Apache</a></li>
<li><a class="reference external" href="http://www.cherokee-project.com/">Cherokee</a></li>
</ul>
<p>Se, porém, você não tem opção exceto servir arquivos de mídia no mesmo
<tt class="docutils literal"><span class="pre">VirtualHost</span></tt> do Apache do Django, aqui está como você pode desligar o mod_python para uma parte
em particular do site:</p>
<div class="highlight-apache"><div class="highlight"><pre><span class="nt">&lt;Location</span> <span class="s">&quot;/media&quot;</span><span class="nt">&gt;</span>
    <span class="nb">SetHandler</span> <span class="k">None</span>
<span class="nt">&lt;/Location&gt;</span>
</pre></div>
</div>
<p>Apenas mude o <tt class="docutils literal"><span class="pre">Location</span></tt> para a URL raiz dos seus arquivos de mídia. Você pode usar também o
<tt class="docutils literal"><span class="pre">&lt;LocationMatch&gt;</span></tt> para casar com uma expressão regular.</p>
<p>Esse exemplo configura o Django na raiz do site mas explicitamente desabilita o Django para
o subdiretório <tt class="docutils literal"><span class="pre">media</span></tt> e qualquer URL quer termine em <tt class="docutils literal"><span class="pre">.jpg</span></tt>, <tt class="docutils literal"><span class="pre">.gif</span></tt> ou
<tt class="docutils literal"><span class="pre">.png</span></tt>:</p>
<div class="highlight-apache"><div class="highlight"><pre><span class="nt">&lt;Location</span> <span class="s">&quot;/&quot;</span><span class="nt">&gt;</span>
    <span class="nb">SetHandler</span> python-program
    <span class="nb">PythonHandler</span> django.core.handlers.modpython
    <span class="nb">SetEnv</span> DJANGO_SETTINGS_MODULE mysite.settings
<span class="nt">&lt;/Location&gt;</span>

<span class="nt">&lt;Location</span> <span class="s">&quot;/media&quot;</span><span class="nt">&gt;</span>
    <span class="nb">SetHandler</span> <span class="k">None</span>
<span class="nt">&lt;/Location&gt;</span>

<span class="nt">&lt;LocationMatch</span> <span class="s">&quot;\.(jpg|gif|png)$&quot;</span><span class="nt">&gt;</span>
    <span class="nb">SetHandler</span> <span class="k">None</span>
<span class="nt">&lt;/LocationMatch&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="s-servindo-os-arquivos-da-administracao">
<span id="servindo-os-arquivos-da-administracao"></span><h2>Servindo os arquivos da administração<a class="headerlink" href="#servindo-os-arquivos-da-administracao" title="Permalink to this headline">¶</a></h2>
<p>Note que o servidor de desenvolvimento do Django automaticamente serve os arquivos de mídia da administração,
mas isso não é automático quando você usa outra disposição de servidor. Você é
responsável por configurar o Apache, ou qualquer outro servidor de mídia que estiver usando, para
servir os arquivos da administração.</p>
<p>Os arquivos da administração ficam na pasta (<tt class="file docutils literal"><span class="pre">django/contrib/admin/media</span></tt>) da distribuição do
Django.</p>
<p>Aqui estão duas formas recomendadas:</p>
<ol class="arabic simple">
<li>Crie um link simbólico para os arquivos de mídia da administração dentro do seu
document root. Dessa forma, todos os seus arquivos relacionados ao Django -- código <strong>e</strong>
templates -- ficam em um único lugar, e você ainda irá ser capaz de fazer um <tt class="docutils literal"><span class="pre">svn</span>
<span class="pre">update</span></tt> no seu código para obter as últimas versões dos templates da administração,
se eles mudarem.</li>
<li>Ou, copie os arquivos de mídia da administração de forma que eles fiquem dentro do
document root do seu Apache.</li>
</ol>
</div>
<div class="section" id="s-usando-eggs-com-o-mod-python">
<span id="usando-eggs-com-o-mod-python"></span><h2>Usando &quot;eggs&quot; com o mod_python<a class="headerlink" href="#usando-eggs-com-o-mod-python" title="Permalink to this headline">¶</a></h2>
<p>Se você instalou o Django de um Python <a class="reference external" href="http://peak.telecommunity.com/DevCenter/PythonEggs">egg</a> ou está usando eggs no seu projeto
Django, algumas configurações extra são requeridas. Crie um arquivo extra no seu
projeto (ou em algum outro lugar) que contenha algo assim:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;PYTHON_EGG_CACHE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;/some/directory&#39;</span>
</pre></div>
</div>
<p>Aqui, <tt class="docutils literal"><span class="pre">/some/directory</span></tt> é um diretório ao qual o servidor Apache tenha acesso de
escrita. Ele será usado como o local de descompactação para qualquer código
que os eggs precisem fazer.</p>
<p>Então você irá precisar dizer ao mod_python para importar esse arquivo antes de fazer
qualquer coisa. Isso é feito usando a diretiva <a class="reference external" href="http://www.modpython.org/live/current/doc-html/dir-other-pimp.html">PythonImport</a> do seu mod_python. Você precisa
garantir que você especificou a diretiva <tt class="docutils literal"><span class="pre">PythonInterpreter</span></tt> do mod_python
como descrito <a class="reference internal" href="#multiplas-instalacoes-do-django-no-mesmo-apache">acima</a> (nesse caso, você precisa fazer isso mesmo que você não esteja servindo
múltiplas instalações). Então, adicione a linha <tt class="docutils literal"><span class="pre">PythonImport</span></tt>
na configuração principal do servidor (i.e., fora das seções <tt class="docutils literal"><span class="pre">Location</span></tt> ou
<tt class="docutils literal"><span class="pre">VirtualHost</span></tt>). Por exemplo:</p>
<div class="highlight-apache"><div class="highlight"><pre><span class="nb">PythonInterpreter</span> my_django
<span class="nb">PythonImport</span> <span class="sx">/path/to/my/project/file.py</span> my_django
</pre></div>
</div>
<p>Note que você pode usar um caminho absoluto aqui (ou um caminho de importação com pontos normal),
como descrito no <a class="reference external" href="http://www.modpython.org/live/current/doc-html/dir-other-pimp.html">manual do mod_python</a>. Nós usamos um caminho absoluto
no exemplo acima porque se quaisquer modificações no Python path forem necessárias para acessar
seu projeto, elas não terão sido feitas no momento em que a linha <tt class="docutils literal"><span class="pre">PythonImport</span></tt>
é processada.</p>
</div>
<div class="section" id="s-tratamento-de-erros">
<span id="tratamento-de-erros"></span><h2>Tratamento de erros<a class="headerlink" href="#tratamento-de-erros" title="Permalink to this headline">¶</a></h2>
<p>QUando você usa o Apache/mod_python, os error serão capturados pelo Django -- em outras
palavras, eles não irão propagar para o nível do Apache nem aparecerão no <tt class="docutils literal"><span class="pre">error_log</span></tt> do Apache.</p>
<p>A exceção a isso é se algo estiver realmente quebrado na sua configuração do Django. Nesse
caso, você verá uma página de &quot;Erro Interno do Servidor&quot; no seu navegador e o
traceback completo do Python no seu arquivo <tt class="docutils literal"><span class="pre">error_log</span></tt> do Apache. O traceback no <tt class="docutils literal"><span class="pre">error_log</span></tt>
ocupa diversas linhas. (Sim, isso é feio e bem chato de ler,
mas é como o mod_python faz as coisas.)</p>
</div>
<div class="section" id="s-se-voce-tiver-uma-falha-de-segmentacao">
<span id="se-voce-tiver-uma-falha-de-segmentacao"></span><h2>Se você tiver uma falha de segmentação<a class="headerlink" href="#se-voce-tiver-uma-falha-de-segmentacao" title="Permalink to this headline">¶</a></h2>
<p>Se o Apache causar uma falha de segmentação, existem duas razões prováveis, nenhuma
das quais tem a ver com o Django em si.</p>
<ol class="arabic simple">
<li>Pode ser que o seu código Python está importando o módulo &quot;pyexpat&quot;,
que pode causar conflito com a versão embutida no Apache. Para informação
completa, veja <a class="reference external" href="http://www.dscpl.com.au/wiki/ModPython/Articles/ExpatCausingApacheCrash">Expat fazendo o Apache travar</a>.</li>
<li>Pode ser porque você está usando o mod_python e o mod_php na mesma instância
do Apache, com o MySQL como seu banco de dados. Em alguns casos,
isso causa um problema conhecido do mod_python devido a conflito de versões no PHP
e no backend do MySQL do Python. Existem informação completa na
<a class="reference external" href="http://modpython.org/FAQ/faqw.py?req=show&amp;file=faq02.013.htp">entrada da FAQ do mod_python</a>.</li>
</ol>
<p>Se você continuar a ter problemas configurando o mod_python, algo interessante a se fazer
e conseguir um site mod_python cru rodando, sem o framework Django. Isso é
um modo fácil de isolar problemas específicos do mod_python. <a class="reference external" href="http://www.dscpl.com.au/wiki/ModPython/Articles/GettingModPythonWorking">Fazendo o mod_python funcionar</a>
detalha esse procedimento.</p>
<p>O próximo passo deve ser editar seu código de teste e adicionar um import de qualquer
código específico do Django que você esteja usando -- suas views, seus models, suas URLconf,
sua configuração de RSS, etc. Coloque esses imports na sua função gerenciadora de teste
e acesse sua URL de teste em um navegador. Se isso causa um crash, você confirmou
que a importação de código Django que causa o problema. Gradualmente reduza o conjunto de
imports até que pare de travar, para que você encontre o módulo específico que causa o
problema. Investigue cada módulo e veja seus imports, conforme necessário.</p>
</div>
<div class="section" id="s-if-you-get-a-unicodeencodeerror">
<span id="if-you-get-a-unicodeencodeerror"></span><h2>If you get a UnicodeEncodeError<a class="headerlink" href="#if-you-get-a-unicodeencodeerror" title="Permalink to this headline">¶</a></h2>
<p>If you're taking advantage of the internationalization features of Django (see
<a class="reference internal" href="../../topics/i18n/index.html"><em>Internationalization and localization</em></a>) and you intend to allow users to upload files, you must
ensure that the environment used to start Apache is configured to accept
non-ASCII file names. If your environment is not correctly configured, you
will trigger <tt class="docutils literal"><span class="pre">UnicodeEncodeError</span></tt> exceptions when calling functions like
<tt class="docutils literal"><span class="pre">os.path()</span></tt> on filenames that contain non-ASCII characters.</p>
<p>To avoid these problems, the environment used to start Apache should contain
settings analogous to the following:</p>
<div class="highlight-apache"><div class="highlight"><pre><span class="nb">export</span> LANG=&#39;en_US.UTF-8&#39;
<span class="nb">export</span> LC_ALL=&#39;en_US.UTF-8&#39;
</pre></div>
</div>
<p>Consult the documentation for your operating system for the appropriate syntax
and location to put these configuration items; <tt class="docutils literal"><span class="pre">/etc/apache2/envvars</span></tt> is a
common location on Unix platforms. Once you have added these statements
to your environment, restart Apache.</p>
</div>
</div>


          </div>         
        </div>
      </div>
      
        
          <div class="yui-b" id="sidebar">
            
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../contents.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Como usar o Django com o Apache e mod_python</a><ul>
<li><a class="reference internal" href="#configuracao-basica">Configuração Básica</a></li>
<li><a class="reference internal" href="#multiplas-instalacoes-do-django-no-mesmo-apache">Múltiplas instalações do Django no mesmo Apache</a></li>
<li><a class="reference internal" href="#executando-um-servidor-de-desenvolvimento-com-o-mod-python">Executando um servidor de desenvolvimento com o mod_python</a></li>
<li><a class="reference internal" href="#servindo-arquivos-de-midia">Servindo arquivos de mídia</a></li>
<li><a class="reference internal" href="#servindo-os-arquivos-da-administracao">Servindo os arquivos da administração</a></li>
<li><a class="reference internal" href="#usando-eggs-com-o-mod-python">Usando &#8220;eggs&#8221; com o mod_python</a></li>
<li><a class="reference internal" href="#tratamento-de-erros">Tratamento de erros</a></li>
<li><a class="reference internal" href="#se-voce-tiver-uma-falha-de-segmentacao">Se você tiver uma falha de segmentação</a></li>
<li><a class="reference internal" href="#if-you-get-a-unicodeencodeerror">If you get a UnicodeEncodeError</a></li>
</ul>
</li>
</ul>

  <h3>Browse</h3>
  <ul>
    
      <li>Prev: <a href="fastcgi.html">Como usar o Django com FastCGI, SCGI ou AJP</a></li>
    
    
      <li>Next: <a href="../error-reporting.html">Reporte de erros via e-mail</a></li>
    
  </ul>
  <h3>Você está aqui:</h3>
  <ul>
      <li>
        <a href="../../index.html">Django v1.3.1 documentation</a>
        
          <ul><li><a href="../index.html">Guias &#8220;como fazer&#8221;</a>
        
          <ul><li><a href="index.html">Implantando o Django</a>
        
        <ul><li>Como usar o Django com o Apache e mod_python</li></ul>
        </li></ul></li></ul>
      </li>
  </ul>  

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/howto/deployment/modpython.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
              <h3>Última atualização:</h3>
              <p class="topless">Dec 25, 2011</p>
          </div> 
        
      
    </div>
    
    <div id="ft">
      <div class="nav">
    &laquo; <a href="fastcgi.html" title="Como usar o Django com FastCGI, SCGI ou AJP">previous</a> 
     |
    <a href="../index.html" title="Guias &amp;#8220;como fazer&amp;#8221;" accesskey="U">up</a>
   |
    <a href="../error-reporting.html" title="Reporte de erros via e-mail">next</a> &raquo;</div>
    </div>
  </div>

      <div class="clearer"></div>
    </div>
  </body>
</html>